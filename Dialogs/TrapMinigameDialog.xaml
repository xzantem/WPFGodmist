<Window x:Class="GodmistWPF.Dialogs.TrapMinigameDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:GodmistWPF.Dialogs"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:converters="clr-namespace:GodmistWPF.Converters"
        mc:Ignorable="d"
        Title="Trap Disarm" 
        Height="600" 
        Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Loaded="OnLoaded"
        Closing="Window_Closing"
        WindowStyle="ToolWindow">
    <Window.Resources>
        <converters:BoolToOpacityConverter x:Key="BoolToOpacityConverter"/>
    </Window.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="10" Margin="0,0,0,10">
            <TextBlock x:Name="TrapTitle" 
                      Text="Disarm the Trap!" 
                      Foreground="White" 
                      FontSize="20" 
                      FontWeight="Bold"
                      VerticalAlignment="Center"/>
        </Border>

        <!-- Main Content Area -->
        <Border Grid.Row="1" 
                Background="#22313F"
                BorderBrush="#4A90E2"
                BorderThickness="1" 
                CornerRadius="4"
                Padding="15">
            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                         HorizontalScrollBarVisibility="Disabled"
                         VerticalAlignment="Center">
                <StackPanel x:Name="TrapContent">
                    <!-- Content will be added dynamically -->
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Code Challenge -->
        <StackPanel x:Name="CodeChallengePanel" Grid.Row="1" Visibility="Collapsed">
            <TextBlock Text="Enter the 4-digit code:" 
                      Foreground="White" 
                      HorizontalAlignment="Center" 
                      Margin="0,10"
                      FontSize="16"/>
            <StackPanel Orientation="Horizontal" 
                       HorizontalAlignment="Center" 
                       Margin="0,20">
                <TextBox x:Name="Digit1" 
                         Width="50" 
                         Height="50" 
                         MaxLength="1" 
                         TextAlignment="Center" 
                         Margin="5" 
                         FontSize="20"
                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                         materialDesign:HintAssist.Hint=" "
                         KeyUp="CodeDigit_KeyUp"/>
                <TextBox x:Name="Digit2" 
                         Width="50" 
                         Height="50" 
                         MaxLength="1" 
                         TextAlignment="Center" 
                         Margin="5" 
                         FontSize="20"
                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                         materialDesign:HintAssist.Hint=" "
                         KeyUp="CodeDigit_KeyUp"/>
                <TextBox x:Name="Digit3" 
                         Width="50" 
                         Height="50" 
                         MaxLength="1" 
                         TextAlignment="Center" 
                         Margin="5" 
                         FontSize="20"
                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                         materialDesign:HintAssist.Hint=" "
                         KeyUp="CodeDigit_KeyUp"/>
                <TextBox x:Name="Digit4" 
                         Width="50" 
                         Height="50" 
                         MaxLength="1" 
                         TextAlignment="Center" 
                         Margin="5" 
                         FontSize="20"
                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                         materialDesign:HintAssist.Hint=" "
                         KeyUp="CodeDigit_KeyUp"/>
            </StackPanel>
            
            <!-- Digit Feedback -->
            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" Margin="0,10,0,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock x:Name="LastAttempt1" 
                              Text=" " 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"/>
                    <TextBlock x:Name="LastAttempt2" 
                              Text=" " 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"/>
                    <TextBlock x:Name="LastAttempt3" 
                              Text=" " 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"/>
                    <TextBlock x:Name="LastAttempt4" 
                              Text=" " 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock x:Name="Digit1Feedback" 
                              Text="?" 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"
                              FontWeight="Bold"/>
                    <TextBlock x:Name="Digit2Feedback" 
                              Text="?" 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"
                              FontWeight="Bold"/>
                    <TextBlock x:Name="Digit3Feedback" 
                              Text="?" 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"
                              FontWeight="Bold"/>
                    <TextBlock x:Name="Digit4Feedback" 
                              Text="?" 
                              Width="50"
                              TextAlignment="Center"
                              Margin="5,0"
                              FontSize="14"
                              FontWeight="Bold"/>
                </StackPanel>
            </StackPanel>
            
            <TextBlock x:Name="CodeFeedback" 
                      Text="" 
                      Foreground="#FF6B6B" 
                      HorizontalAlignment="Center" 
                      Margin="0,10"
                      TextWrapping="Wrap"
                      TextAlignment="Center"/>
            <TextBlock x:Name="CodeAttempts" 
                      Text="" 
                      Foreground="#A9CCE3" 
                      HorizontalAlignment="Center" 
                      Margin="0,5"
                      FontStyle="Italic"/>
        </StackPanel>

        <!-- Reaction Challenge -->
        <Grid x:Name="ReactionChallengePanel" Grid.Row="1" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Score and Timer -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                <TextBlock x:Name="ReactionScore" 
                          Text="Hits: 0/10" 
                          Foreground="#2ECC71"
                          FontSize="18"
                          FontWeight="Bold"
                          Margin="0,0,30,0"/>
                <TextBlock x:Name="ReactionTimer" 
                          Text="Time: 0.00s" 
                          Foreground="#3498DB"
                          FontSize="18"
                          FontWeight="Bold"/>
            </StackPanel>
            
            <!-- Status -->
            <TextBlock x:Name="ReactionStatus" 
                      Grid.Row="1"
                      Text="Get ready..." 
                      Foreground="White"
                      HorizontalAlignment="Center" 
                      VerticalAlignment="Center"
                      FontSize="24"
                      FontWeight="Bold"
                      TextWrapping="Wrap"
                      TextAlignment="Center"
                      Margin="0,0,0,20"/>
                      
            <!-- Game Area -->
            <Canvas Grid.Row="2" Width="400" Height="300" Background="#2C3E50" Margin="0,10">
                <Button x:Name="ReactionButton" 
                        Content="âš¡" 
                        Width="50"
                        Height="50"
                        Padding="0"
                        FontSize="24"
                        FontWeight="Bold"
                        Style="{StaticResource MaterialDesignFloatingActionButton}"
                        Background="#E74C3C"
                        Foreground="White"
                        Click="ReactionButton_Click"
                        Visibility="Collapsed"
                        materialDesign:RippleAssist.Feedback="#C0392B"
                        Effect="{StaticResource MaterialDesignElevationShadow2}"
                        BorderThickness="0"/>
            </Canvas>
            
            <!-- Instructions -->
            <StackPanel Grid.Row="3" Margin="0,20,0,0">
                <TextBlock x:Name="ReactionInstructions" 
                          Text="Click the red button as fast as you can when it appears!" 
                          Foreground="#A9CCE3"
                          HorizontalAlignment="Center" 
                          Margin="0,10,0,0"
                          FontSize="14"
                          TextWrapping="Wrap"
                          TextAlignment="Center"/>
                <TextBlock x:Name="ReactionAttempts" 
                          Text="" 
                          Foreground="#E74C3C"
                          HorizontalAlignment="Center" 
                          Margin="0,10,0,0"
                          FontSize="14"
                          FontWeight="Bold"
                          TextWrapping="Wrap"
                          TextAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Wordle Challenge -->
        <StackPanel x:Name="WordleChallengePanel" Grid.Row="1" Visibility="Visible">
            <TextBlock Text="Guess the word!" 
                      Foreground="White" 
                      HorizontalAlignment="Center" 
                      Margin="0,20,0,20"
                      FontSize="18"
                      FontWeight="Bold"/>
            <TextBlock x:Name="WordleWordLength" 
                      Text="" 
                      Foreground="#A9CCE3" 
                      HorizontalAlignment="Center" 
                      Margin="0,0,0,20"
                      FontSize="14"/>
            
            <StackPanel x:Name="WordleGuesses" 
                       HorizontalAlignment="Center" 
                       Margin="0,10">
                <!-- Guesses will be added here -->
            </StackPanel>
            
            <StackPanel x:Name="WordleInputContainer" 
                       Orientation="Horizontal" 
                       HorizontalAlignment="Center" 
                       Margin="0,20,0,10">
                <!-- Letter boxes will be added here dynamically -->
            </StackPanel>
            
            <TextBlock x:Name="WordleFeedback" 
                      Text="" 
                      Foreground="#FF6B6B" 
                      HorizontalAlignment="Center" 
                      Margin="0,10"
                      TextWrapping="Wrap"
                      TextAlignment="Center"/>
                      
            <TextBlock x:Name="WordleAttempts" 
                      Text="" 
                      Foreground="#A9CCE3" 
                      HorizontalAlignment="Center" 
                      Margin="0,5"
                      FontStyle="Italic"/>
        </StackPanel>

        <!-- Grid Challenge -->
        <StackPanel x:Name="GridChallengePanel" 
                   Grid.Row="1" 
                   HorizontalAlignment="Center" 
                   VerticalAlignment="Center"
                   Visibility="Collapsed">
            <TextBlock Text="Find the safe tiles!" 
                      Foreground="White" 
                      HorizontalAlignment="Center" 
                      Margin="0,0,0,20"
                      FontSize="18"
                      FontWeight="Bold"/>
            <ItemsControl x:Name="GridContainer" 
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Rows="3" Columns="3"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button x:Name="GridButton"
                                Width="60"
                                Height="60"
                                Margin="5"
                                FontSize="20"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Click="GridButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" 
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="2"
                                            CornerRadius="4">
                                        <TextBlock Text="{Binding Content}"
                                                  HorizontalAlignment="Center" 
                                                  VerticalAlignment="Center"
                                                  Foreground="White"
                                                  FontSize="16"
                                                  FontWeight="Bold"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="BorderBrush" Value="#4A90E2"/>
                                            <Setter TargetName="border" Property="Background" Value="#2C3E50"/>
                                        </Trigger>
                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#2E8B57"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsSafe}" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#2E8B57"/>
                                            <Setter TargetName="border" Property="Opacity" Value="0.7"/>
                                        </DataTrigger>

                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            
            <Button x:Name="GridConfirmButton"
                    Content="Confirm Selection"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Background="#27AE60"
                    Foreground="White"
                    Margin="0,20,0,0"
                    Padding="20,5"
                    HorizontalAlignment="Center"
                    Click="GridConfirmButton_Click"
                    IsEnabled="False"/>
                    
            <TextBlock x:Name="GridChallengeStatus" 
                      Text="" 
                      Foreground="#A9CCE3" 
                      HorizontalAlignment="Center" 
                      Margin="0,15,0,0"
                      FontSize="14"
                      TextWrapping="Wrap"
                      TextAlignment="Center"/>
                      
            <TextBlock x:Name="GridAttempts" 
                      Text="" 
                      Foreground="#FF6B6B" 
                      HorizontalAlignment="Center" 
                      Margin="0,10,0,0"
                      FontSize="14"
                      FontWeight="SemiBold"/>
        </StackPanel>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
                Background="#2C3E50" 
                Padding="10"
                Margin="0,10,0,0">
            <TextBlock x:Name="StatusText" 
                      Text="Disarm the trap to avoid damage!" 
                      Foreground="White" 
                      FontSize="12"/>
        </Border>
    </Grid>
</Window>
